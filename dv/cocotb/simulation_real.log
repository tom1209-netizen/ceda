rm -rf sim_build results.xml
make -f /home/tom/.pyenv/versions/3.10.18/lib/python3.10/site-packages/cocotb_tools/makefiles/Makefile.sim \
	SIM=icarus \
	TOPLEVEL_LANG=verilog \
	VERILOG_SOURCES="../../hw/rtl/common/pe.v ../../hw/rtl/common/line_buffer.v \
	                 ../../hw/rtl/gaussian/window_5x5.v ../../hw/rtl/gaussian/gaussian_5x5_core.v \
	                 ../../hw/rtl/gaussian/gaussian_stage.v" \
	TOPLEVEL=gaussian_stage \
	COCOTB_TEST_MODULES=tests.test_gaussian_stage \
	COMPILE_ARGS="-Pgaussian_stage.IMG_WIDTH=1920 -Pgaussian_stage.IMG_HEIGHT=1080"
make[1]: Entering directory '/home/tom/Documents/ceda/dv/cocotb'
rm -f results.xml
"make" -f /home/tom/.pyenv/versions/3.10.18/lib/python3.10/site-packages/cocotb_tools/makefiles/Makefile.sim results.xml
make[2]: Entering directory '/home/tom/Documents/ceda/dv/cocotb'
mkdir -p sim_build
/usr/bin/iverilog -o sim_build/sim.vvp -s gaussian_stage -g2012 -Pgaussian_stage.IMG_WIDTH=1920 -Pgaussian_stage.IMG_HEIGHT=1080  ../../hw/rtl/common/pe.v ../../hw/rtl/common/line_buffer.v 	                 ../../hw/rtl/gaussian/window_5x5.v ../../hw/rtl/gaussian/gaussian_5x5_core.v 	                 ../../hw/rtl/gaussian/gaussian_stage.v
rm -f results.xml
COCOTB_TEST_MODULES=tests.test_gaussian_stage COCOTB_TESTCASE= COCOTB_TEST_FILTER=test_gaussian_stage_real_image COCOTB_TOPLEVEL=gaussian_stage TOPLEVEL_LANG=verilog \
         /usr/bin/vvp -M /home/tom/.pyenv/versions/3.10.18/lib/python3.10/site-packages/cocotb/libs -m libcocotbvpi_icarus   sim_build/sim.vvp   
     -.--ns INFO     gpi                                ..mbed/gpi_embed.cpp:93   in _embed_init_python              Using Python 3.10.14 interpreter at /home/tom/.pyenv/versions/3.10.18/bin/python3.10
     -.--ns INFO     gpi                                ../gpi/GpiCommon.cpp:79   in gpi_print_registered_impl       VPI registered
     0.00ns INFO     cocotb                             Running on Icarus Verilog version 12.0 (stable)
     0.00ns INFO     cocotb                             Seeding Python random module with 1770208378
     0.00ns INFO     cocotb                             Initialized cocotb v2.0.1 from /home/tom/.pyenv/versions/3.10.18/lib/python3.10/site-packages/cocotb
     0.00ns INFO     cocotb                             Running tests
     0.00ns INFO     cocotb.regression                  running tests.test_gaussian_stage.test_gaussian_stage_real_image (1/1)
                                                            Test with a realistic image pattern and verify against reference model
    20.00ns INFO     cocotb.gaussian_stage              Testing with image size: 1920x1080
22044360.00ns INFO     cocotb.gaussian_stage              Saved input/output images to /home/tom/Documents/ceda/dv/cocotb/tests/test_output/
22044360.00ns ERROR    cocotb.gaussian_stage              Found 1886701 mismatching pixels
22044360.00ns ERROR    cocotb.gaussian_stage              Max diff: 254
22044360.00ns ERROR    cocotb.gaussian_stage               mismatch at (5,0): got 1, exp 0
22044360.00ns ERROR    cocotb.gaussian_stage               mismatch at (6,0): got 1, exp 0
22044360.00ns ERROR    cocotb.gaussian_stage               mismatch at (7,0): got 1, exp 0
22044360.00ns ERROR    cocotb.gaussian_stage               mismatch at (13,0): got 2, exp 1
22044360.00ns ERROR    cocotb.gaussian_stage               mismatch at (14,0): got 2, exp 1
22044360.00ns WARNING  ..e.test_gaussian_stage_real_image Image comparison failed with 1886701 mismatches
                                                          assert np.int64(1886701) == 0
                                                          Traceback (most recent call last):
                                                            File "/home/tom/Documents/ceda/dv/cocotb/tests/test_gaussian_stage.py", line 253, in test_gaussian_stage_real_image
                                                              assert mismatches == 0, f"Image comparison failed with {mismatches} mismatches"
                                                          AssertionError: Image comparison failed with 1886701 mismatches
                                                          assert np.int64(1886701) == 0
22044360.00ns WARNING  cocotb.regression                  tests.test_gaussian_stage.test_gaussian_stage_real_image failed
22044360.00ns INFO     cocotb.regression                  ******************************************************************************************************************
                                                          ** TEST                                                      STATUS  SIM TIME (ns)  REAL TIME (s)  RATIO (ns/s) **
                                                          ******************************************************************************************************************
                                                          ** tests.test_gaussian_stage.test_gaussian_stage_real_image   FAIL    22044360.00         255.31      86344.21  **
                                                          ******************************************************************************************************************
                                                          ** TESTS=1 PASS=0 FAIL=1 SKIP=0                                       22044360.00         255.32      86340.29  **
                                                          ******************************************************************************************************************
make[2]: *** [/home/tom/.pyenv/versions/3.10.18/lib/python3.10/site-packages/cocotb_tools/makefiles/simulators/Makefile.icarus:67: results.xml] Error 1
make[2]: Leaving directory '/home/tom/Documents/ceda/dv/cocotb'
make[1]: *** [/home/tom/.pyenv/versions/3.10.18/lib/python3.10/site-packages/cocotb_tools/makefiles/Makefile.inc:17: sim] Error 2
make[1]: Leaving directory '/home/tom/Documents/ceda/dv/cocotb'
make: *** [Makefile:116: test_gaussian_stage] Error 2
